import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
import textwrap  # To wrap text to a fixed width

# SMTP Server Configuration
SMTP_SERVER = "smtp.yourmailserver.com"  # Replace with your SMTP server
SMTP_PORT = 587  # Common SMTP port for TLS
SMTP_USERNAME = "your_email@example.com"  # Replace with your email
SMTP_PASSWORD = "your_password"  # Replace with your password

# Sender and Receiver Details
sender_email = "your_email@example.com"
receiver_email = "recipient@example.com"

# Read the .out file content
file_path = "output.out"  # Replace with actual file path
with open(file_path, "r") as file:
    file_content = file.read()

# Wrap text to 80 characters per line for better readability
wrapped_content = "\n".join(textwrap.wrap(file_content, width=80))

# Create Email Message
message = MIMEMultipart()
message["From"] = sender_email
message["To"] = receiver_email
message["Subject"] = ""

# Email Body (Formatted for Readability in Outlook)
email_body = f"""
<html>
<head>
    <style>
        body {{
            font-family: Arial, sans-serif;
        }}
        table {{
            width: 100%;
            max-width: 600px;
            border-collapse: collapse;
        }}
        td {{
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
        }}
    </style>
</head>
<body>
    <p>Dear Team,</p>
    <p>Please find below the Snowflake account details extracted from the system:</p>
    <table>
        <tr><td>{wrapped_content.replace("\n", "<br>")}</td></tr>
    </table>
    <p>If you have any questions, please let me know.</p>
    <p>Best regards,<br>Your Name<br>Your Position<br>Your Company</p>
</body>
</html>
"""

# Attach Email Body
message.attach(MIMEText(email_body, "html"))

# Send Email
try:
    with smtplib.SMTP(SMTP_SERVER, SMTP_PORT) as server:
        server.starttls()  # Secure connection
        server.login(SMTP_USERNAME, SMTP_PASSWORD)
        server.sendmail(sender_email, receiver_email, message.as_string())
    print("Email sent successfully!")
except Exception as e:
    print(f"Failed to send email: {e}")